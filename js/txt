document.addEventListener("DOMContentLoaded", () => {
  // ----- SIGNUP -----
  const signupForm = document.getElementById("signupForm");
  if (signupForm) {
    signupForm.addEventListener("submit", (e) => {
      e.preventDefault();

      const username = document.getElementById("signupUsername").value.trim();
      const password = document.getElementById("signupPassword").value;
      const confirmPassword = document.getElementById("signupConfirmPassword").value;

      let users = JSON.parse(localStorage.getItem("users")) || [];

      if (users.find(u => u.username === username)) {
        alert("‚ö†Ô∏è Username already exists!");
        return;
      }

      if (password !== confirmPassword) {
        alert("‚ö†Ô∏è Passwords do not match!");
        return;
      }

      const signupDate = new Date().toISOString().split("T")[0];

      // Default role: user
      users.push({ username, password, signupDate, role: "user" });
      localStorage.setItem("users", JSON.stringify(users));

      alert("‚úÖ Signup successful! Please login.");
      window.location.href = "login.html";
    });
  }

  // ----- LOGIN -----
  const loginForm = document.getElementById("loginForm");
  if (loginForm) {
    loginForm.addEventListener("submit", (e) => {
      e.preventDefault();

      const username = document.getElementById("loginUsername").value.trim();
      const password = document.getElementById("loginPassword").value;

      let users = JSON.parse(localStorage.getItem("users")) || [];
      let user = users.find(u => u.username === username && u.password === password);

      if (user) {
        sessionStorage.setItem("loggedInUser", JSON.stringify(user)); // Store object
        window.location.href = "index.html"; // Redirect to homepage
      }
       else {
        alert("‚ö†Ô∏è Invalid credentials!");
      }
    });
  }
});

// ----- LOGOUT -----
function logout() {
  sessionStorage.removeItem("loggedInUser");
  window.location.href = "login.html";
}

// ----- PASSWORD TOGGLE -----
function togglePassword(fieldId, toggleIcon) {
  const field = document.getElementById(fieldId);
  if (field.type === "password") {
    field.type = "text";
    toggleIcon.textContent = "üôà";
  } else {
    field.type = "password";
    toggleIcon.textContent = "üëÅÔ∏è";
  }
}
